---
title: "AAPL"
author: "Valery Andruynichev"
date: '04 dec 2017 year'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Проведем анализ одномерного динамического ряда акций Apple

Загрузим необходимые компоненты

```{r,message=FALSE,warning=FALSE}
library(reshape2) # Манипулирование данными
library(forecast) # Построение модели  ARIMA
library(tseries) #  Проверка стационарности 
```

Для анализа загрузим файл .csv

Укажем папку с файлом
```{r}
dir<-"D://GH//AAPL//"
```
Загрузка файла .csv
```{r}
ap<-read.csv(paste(dir,'AAPL.csv',sep=''),stringsAsFactors = FALSE)
head(ap)
```

Просмотрим характеристики даныых
```{r}
apply(ap,2,class)
```
Поменяем класс данных на числовые
```{r}
ap[,c(2:7)]<-sapply(ap[,c(2:7)],function(x) as.numeric (x)) 
ap[,1]<-as.Date(ap[,1]) 
ap<-ap[ap$Date>'2015-01-01',] 
```
Толбец с дататами присвоем класс "дата" и ограничем выборку с 2015-01-01
```{r}
ap[,1]<-as.Date(ap[,1]) 
ap<-ap[ap$Date>'2015-01-01',] 
```
```{r}
apply(ap,2,class)
head(ap)
```

Построим график цен закрытия 
```{r}
plot(ap$Date,ap$Close, main='Динамика цен акций Apple',ylab = "Цена закрытия, $", xlab = "Дата")
```
И граик логарифма цен закрытия
```{r}
plot(ap$Date,log(ap$Close), main='Динамика цен акций Apple',ylab = "Логарифм цены закрытия, $", xlab = "Дата")
```

Проведем проверку данных Apple

Проверим времянной ряд на стационарность с уровнем значимости $\alpha$ =0.05
```{r}
adf.test(log(ap$Close))
```

P-value больше уровня значимости, гипотеза об отсутствии стационарности ряда принимается. Это говорит нам об присутсвии тренда.



Проверим первые разности  логарифмов цен и проверим на стационарность получившийся ряд. Для этого создадим вспомогательный массив

```{r}
ap_dif<-data.frame(Date = ap$Date[-1],Close=diff(log(ap$Close),lag = 1)) #  Создание вспомогательного массива с первыми разности
head(ap_dif) 
```

Проверим получившийся ряд на стационарность

```{r,message=FALSE}
adf.test(ap_dif$Close)
```
P-value меньше уровня значимости, гипотеза об отсутствии стационарности ряда не принимается. Это говорит нам об отсутсвии тренда.

Построим грайик созданного ряда
```{r}
plot(ap_dif$Date,ap_dif$Close, main= 'Динамика логарифмической доходности акций Apple')
```
По графику мы также видим, что тренд в данном ряде отсутствует

Построим автокорреляционную и частную автокорреляционную функции для ряда доходностей акций Aple

```{r}
acf(ap_dif$Close)
pacf(ap_dif$Close)
```
Графики  acf и pacf не дают возможности однозначно идентифицировать вид динамического ряда. Ряд может содержать как элементы авторегрессионного процесса, так и скользящего среднего. Автокорреляционная функция имеет осциллирующий характер, при этом первые лаги могут быть значимы (скользящее среднее). Частная  автокорреляционная функция также указывает на возможную значимость первых нескольких лагов (авторегрессия)

Получим модель ARIMA для логарифмических доходностей

Для получения модели ARIMA jсуществим автоматический выбор модели с помощью функции auto.arima библиотеки forecast.
```{r}
m<-auto.arima(ap_dif$Close)
m
```

В результате автоматичесого выбора получим модель ARIMA(0,0,0), т.е. комбинацию процесса авторегрессии четвертого порядка и процесса скользящего среднего четвертого порядка. Порядок интеграции модели равен нулю, это означает, что динамика ряда доходностей (или разностей логарифмов цен) носит стационарный характер.
Модель имеет следующий вид:

$\Delta y_t=$$`r round(m$coef[1],3)`$$\Delta y_{t-1} +$$`r round(m$coef[2],3)`$$\Delta y_{t-2}+$$`r round(m$coef[3],3)`$$\Delta y_{t-3}$$`r round(m$coef[4],3)`$$\Delta y_{t-4}$$+\varepsilon_t$$`r round(m$coef[5],3)`$$\varepsilon_{t-1}$$`r round(m$coef[6],3)`$$\varepsilon_{t-2}$$`r round(m$coef[7],3)`$$\varepsilon_{t-3}+$$`r round(m$coef[8],3)`$$\varepsilon_{t-4}$

В качестве примера можно применить автоматический выбор модели для исходного ряда логарифмов цен. Результат полностью совпал с предыдущей моделью, при этом порядок интеграции равен 1, что еще раз подтверждает результат предыдущей модели и необходимость преобразования исходного ряда логарифмов цен. 

```{r}
mlog<-auto.arima(log(ap$Close))
mlog
```

