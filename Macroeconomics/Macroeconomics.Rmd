---
title: "Macroeconomics"
author: "Valery Andruynichev"
date: '29 nov 2017 year'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

В данной работе мы построим регрессионые модели, проведем их анализ.

1) Загрузка и обработка данных

Загрузка необходимых пакетов

```{r,warning=FALSE,message=FALSE}
library(reshape2) # Манипулирование данными
library(lmtest) #  Тесты, используемые для диагностики уравнения регрессии
library(scales) # Преобразование в проценты
library(memisc) # для работы с моделями
```

Загрузим данные 
```{r}
dir<-"D://GH//Macroeconomics//"# указание директории
wb<-read.csv(paste(dir,'wb_econometrics.csv',sep=''),stringsAsFactors = FALSE)#данные всемирного банка
ir<-read.csv(paste(dir,'indicators_regression_2.csv',sep=''),stringsAsFactors = FALSE)#список индикаторов
```
Добавим в список индикаторов дополнительные индикаторы
```{r}
ir<-c("Exports of goods and services (annual % growth)","Industry, value added (annual % growth)",
"Household final consumption expenditure, etc. (annual % growth)",
"Adjusted net national income (annual % growth)",ir)
```
Рассмотрим индикаторы
```{r}
ir
```

Преобразуем данные всемирного банка в длинный формат, переименуем показатель varible d Year
и переведем данный показатель в числовой формат
```{r}
wb<-melt(wb,id=colnames(wb)[1:5])
colnames(wb)[6]<-'Year' 
wb$Year<-as.numeric(gsub('X','',as.character(wb$Year)))
```

Выберем из данных всемирного банка данные, соответствующие выбранным нами индикаторам

```{r}
wb_reg<-wb[wb$Indicator.Name %in% ir$Indicator&wb$Year==2001,c(2,3,5,7)]#создание подмножества индикаторов, выбираем 2001 г.
wb_reg<-(dcast(wb_reg,Country.name+region~Indicator.Name))# переводим таблицу в "широкий формат"
head(wb_reg)
```

Выберем регион "Африка" как базовый регион (все наши расчеты и модели будут строиться относительно региона "Африка")

```{r}
wb_reg$region<-as.factor(wb_reg$region)
unique(wb_reg$region)
wb_reg$region<-relevel(wb_reg$region,ref='Africa')
```

В получившейся выборки находятся пустые(NA) значения, оптимизируем выборку:

Удалим строчки с количеством пустых значений более 60
```{r
sapply(wb_reg, function(x){sum(is.na(x))})#сумма пустых значений по каждому индикатору
wb_reg<-wb_reg[,sapply(wb_reg, function(x){sum(is.na(x))})<60]#удаляем столбцы, содержащие более 60 пропущеных значений
sapply(wb_reg, function(x){sum(is.na(x))})#проверяем на пустые(NA) значения еще раз
wb_reg<-na.omit(wb_reg)# удаляем  строки, содержащие хотя бы одно пропущенное значение
sapply(wb_reg, function(x){sum(is.na(x))})#проверяем на пустые(NA) значения еще раз
country_names<-wb_reg[,1] #вспомогательный массив, содержащий название стран
wb_reg<-wb_reg[,-1]# удаляем столбец с названием стран
head(wb_reg)
dim(wb_reg)  # размерность преобразованной таблицы
```

Оптимизируем названия индикаторов 

```{r}
colnames(wb_reg)<-sapply(colnames(wb_reg),function(x) {gsub("\\(% of GDP\\)|\\(annual %\\)|\\(annual % growth\\)|\\s|\\.|\\,|\\'|\\:",'',x)}) 
colnames(wb_reg)
```

2) Создание и анализ линенйных моделей

В качестве исследуемой или зависимой переменной выберем показатель годового прироста ВВП. Остальные показатели, включая принадлежность к континенту, составляют массив объясняющих переменных. Проведем регрессионный анализ с помощью двух вариантов, используя пошаговую модель с включением переменных и исключая переменные. Все гипотезы будем проверять на уровне значимости $\alpha$ =0.05.

Пошаговое включение объяснящих переменных в модель

1я модель: зависимость роста ВВП от роста добавленной стоимости в промышленности

```{r}
m1=lm(wb_reg$GDPgrowth~wb_reg$Industryvalueadded)
summary(m1)
```

В соответствие со значением F-статистики (p-value меньше 0.05) уравнение можно считать статистически значимым. Значение$R^2$ равно  `r percent(summary(m1)$r.squared)` . Прирост добавленой стоимости в производстве оказывает достаточное влияние на рост ВВП. Также на рост ВВП сильное влияние оказывает база самого ВВП p-value Intercept менее 0.05

2я модель: зависимость роста ВВП от роста добавленной стоимости в промышленности, континента и прироста населения

```{r}
m2=lm(wb_reg$GDPgrowth~wb_reg$region+wb_reg$Industryvalueadded+wb_reg$Populationgrowth)
summary(m2)
```

В соответствие со значением F-статистики (p-value меньше 0.05) уравнение можно считать статистически значимым. Значение $R^2$ незначительно увеличилось и стало равно `r percent(summary(m2)$r.squared)` . Прирост добавленой стоимости в производстве оказывает достаточное влияние на рост ВВП. А p-value роста населения более 0.05, следовательно рост населения практически не влияет на рост ВВП. В результатах модели также можно увидеть, что рост ВВП очень слабо зависит от континента в котором он находится. Но сильно зависит от базы расчета ВВП p-value Intercept менее 0.05

3я модель: зависимость роста ВВП от роста добавленной стоимости в промышленности, прироста населения, роста инфляционного дифлятора ВВП и роста инфляции потребительских цен

```{r}
m3=lm(wb_reg$GDPgrowth~wb_reg$region+wb_reg$Industryvalueadded+wb_reg$Populationgrowth+
        wb_reg$InflationGDPdeflator+wb_reg$Inflationconsumerprices)
summary(m3)
```

В соответствие со значением F-статистики (p-value меньше 0.05) уравнение можно считать статистически значимым. Значение $R^2$ незначительно увеличилось и стало равно `r percent(summary(m3)$r.squared)` . Прирост добавленой стоимости в производстве оказывает достаточное влияние на рост ВВП. А p-value роста населения, инфляционного дифлятора ВВП и роста инфляции потребительских цен  более 0.05, следовательно данные показатели очень слабо влияют на рост ВВП. Начальная база ВВП уже не так сильно влияет на рост ВВП, p-value Intercept увеличилось до 0.00056

4я модель: зависимость роста ВВП от роста добавленной стоимости в промышленности, роста добавленой стоимости в сфере улуг и роста денежной массы

```{r}
m4=lm(wb_reg$GDPgrowth~wb_reg$Industryvalueadded+wb_reg$Broadmoneygrowth+wb_reg$Servicesetcvalueadded)
summary(m4)
```

В соответствие со значением F-статистики (p-value меньше 0.05) уравнение можно считать статистически значимым. Значение $R^2$ незначительно уменьшилось и стало равно `r percent(summary(m4)$r.squared)` . Прирост добавленой стоимости в производстве оказывает достаточное влияние на рост ВВП. А рост денежной массы и добавочной стоимости в сфере услуг слабо влияют на ВВП. Причем рос денежной массы в Африке имеет отрицательное значение, следовательно увеличение денежной массы снижает рост ВВП.

5я модель зависимость роста ВВП от роста денежной массы и инфляционного дефлятора ВВП

```{r}
m5=lm(wb_reg$GDPgrowth~wb_reg$Broadmoneygrowth+wb_reg$InflationGDPdeflator)
summary(m5)
```

В соответствие со значением F-статистики (p-value больше 0.05) уравнение можно считать статистически значимым. Значение $R^2$ значительно уменьшилось и стало равно `r percent(summary(m5)$r.squared)` .
Следоватенльно уровнение не значимо. Однако, мы можем заметить, что инфляциооный дефлятор ВВП имее отрецательный регрессор, а рост денежной массы положительный. Коэффициент их отношения `r(summary(m5)wb_reg$Broadmoneygrowth$Estimate/abs(summary(m5)wb_reg$InflationGDPdeflator))` меньше 1, что означает что рост денежной массы вызовет рост инфляции выше роста ВВП 

Сравним модели
```{r}
mtable(m1,m2,m3,m4,m5)
```
Самой лучшей модель можно считать модель m3 с самым большим $R^2$ 










